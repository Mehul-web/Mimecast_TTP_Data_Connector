id: 91267889-770d-451b-9ed8-d3ed260c48e3
Function:
  Title: Parser for Mimecast SEG Cloud Gateway
  Version: "1.0.0"
  LastUpdated: "2024-07-25"
Category: Microsoft Sentinel Parser
FunctionName: MimecastCG
FunctionAlias: MimecastCG
FunctionQuery: |
  let dummy_table = datatable(TimeGenerated: datetime) [];
  let MimecastCG_view = view() {
  union isfuzzy=true dummy_table,
  Seg_Cg_CL
      | extend  
          UrlCategory = columnifexists("urlCategory_s", ""),
          ScanResults = columnifexists("scanResults_s", ""),
          FileName = columnifexists("fileName_s", ""),
          Sha256 = columnifexists("sha256_s", ""),
          FileExtension = columnifexists("fileExtension_s", ""),
          VirusFound = columnifexists("virusFound_s", ""),
          Sha1 = columnifexists("sha1_s", ""),
          SenderDomain = columnifexists("senderDomain_s", ""),
          Md5 = columnifexists("md5_g", ""),
          CustomThreatDictionary = columnifexists("customThreatDictionary_s", ""),
          ItemsDetected = columnifexists("itemsDetected_s", ""),
          SimilarCustomExternalDomain = columnifexists("similarCustomExternalDomain_s", ""),
          TaggedExternal = columnifexists("taggedExternal_s", ""),
          SimilarInternalDomain = columnifexists("similarInternalDomain_s", ""),
          NewDomain = columnifexists("newDomain_s", ""),
          InternalUserName = columnifexists("internalUserName_s", ""),
          MimecastThreatDictionary = columnifexists("mimecastThreatDictionary_s", ""),
          SimilarMimecastExternalDomain = columnifexists("similarMimecastExternalDomain_s", ""),
          CustomNameMatch = columnifexists("customNameMatch_s", ""),
          TaggedMalicious = columnifexists("taggedMalicious_s", ""),
          ReplyMismatch = columnifexists("replyMismatch_s", ""),
          AggregateIdS = columnifexists("aggregateId_s", ""),
          AggregateIdG = columnifexists("aggregateId_g", ""),
          RejectionType = columnifexists("rejectionType_s", ""),
          RejectionCode = columnifexists("rejectionCode_s", ""),
          RejectionInfo = columnifexists("rejectionInfo_s", ""),
          Delivered = columnifexists("delivered_s", ""),
          DestinationIp = columnifexists("destinationIp_s", ""),
          Hostname = columnifexists("Hostname_s", ""), // Changed to uppercase first letter
          DeliveryAttempts = columnifexists("deliveryAttempts_s", ""),
          TlsUsed = columnifexists("tlsUsed_s", ""),
          DeliveryErrors = columnifexists("deliveryErrors_s", ""),
          Attachments = columnifexists("attachments_s", ""),
          Route = columnifexists("route_s", ""),
          ProcessingId = columnifexists("processingId_s", ""),
          AccountId = columnifexists("accountId_s", ""),
          Action = columnifexists("action_s", ""),
          Timestamp = columnifexists("timestamp_d", ""),
          SenderEnvelope = columnifexists("senderEnvelope_s", ""),
          MessageId = columnifexists("messageId_s", ""),
          Subject = columnifexists("subject_s", ""),
          TotalSizeAttachments = columnifexists("totalSizeAttachments_s", ""),
          NumberAttachments = columnifexists("numberAttachments_s", ""),
          EmailSize = columnifexists("emailSize_s", ""),
          Type = columnifexists("type_s", ""),
          Subtype = columnifexists("subtype_s", ""),
          MonitoredDomainSource = columnifexists("monitoredDomainSource_s", ""),
          SimilarDomain = columnifexists("similarDomain_s", ""),
          Offset = columnifexists("_offset_d", ""),
          Partition = columnifexists("_partition_d", ""),
          HoldReason = columnifexists("holdReason_s", ""),
          Recipients = columnifexists("recipients_s", ""),
          SenderIp = columnifexists("senderIp_s", ""),
          Direction = columnifexists("direction_s", ""),
          SenderHeader = columnifexists("senderHeader_s", ""),
          TlsVersion = columnifexists("tlsVersion_s", ""),
          TlsCipher = columnifexists("tlsCipher_s", ""),
          SpamInfo = columnifexists("spamInfo_s", ""),
          SpamProcessingDetail = columnifexists("spamProcessingDetail_s", "")
      | summarize arg_max(TimeGenerated,*) by UrlCategory,
        ScanResults,
        FileName,
        Sha256,
        FileExtension,
        VirusFound,
        Sha1,
        SenderDomain,
        Md5,
        CustomThreatDictionary,
        ItemsDetected,
        SimilarCustomExternalDomain,
        TaggedExternal,
        SimilarInternalDomain,
        NewDomain,
        InternalUserName,
        MimecastThreatDictionary,
        SimilarMimecastExternalDomain,
        CustomNameMatch,
        TaggedMalicious,
        ReplyMismatch,
        AggregateId = coalesce(AggregateIdS,AggregateIdG),
        RejectionType,
        RejectionCode,
        RejectionInfo,
        Delivered,
        DestinationIp,
        Hostname,
        DeliveryAttempts,
        TlsUsed,
        DeliveryErrors,
        Attachments,
        Route,
        ProcessingId,
        AccountId,
        Action,
        Timestamp,
        SenderEnvelope,
        MessageId,
        Subject,
        TotalSizeAttachments,
        NumberAttachments,
        EmailSize,
        Type,
        Subtype,
        MonitoredDomainSource,
        SimilarDomain,
        HoldReason,
        Recipients,
        SenderIp,
        Direction,
        SenderHeader,
        TlsVersion,
        TlsCipher,
        SpamInfo,
        SpamProcessingDetail
      | project 
          TimeGenerated,
          UrlCategory,
          ScanResults,
          FileName,
          Sha256,
          FileExtension,
          VirusFound,
          Sha1,
          SenderDomain,
          Md5,
          CustomThreatDictionary,
          ItemsDetected,
          SimilarCustomExternalDomain,
          TaggedExternal,
          SimilarInternalDomain,
          NewDomain,
          InternalUserName,
          MimecastThreatDictionary,
          SimilarMimecastExternalDomain,
          CustomNameMatch,
          TaggedMalicious,
          ReplyMismatch,
          AggregateId = coalesce(AggregateIdS,AggregateIdG),
          RejectionType,
          RejectionCode,
          RejectionInfo,
          Delivered,
          DestinationIp,
          Hostname,
          DeliveryAttempts,
          TlsUsed,
          DeliveryErrors,
          Attachments,
          Route,
          ProcessingId,
          AccountId,
          Action,
          Timestamp,
          SenderEnvelope,
          MessageId,
          Subject,
          TotalSizeAttachments,
          NumberAttachments,
          EmailSize,
          Type,
          Subtype,
          MonitoredDomainSource,
          SimilarDomain,
          Offset,
          Partition,
          HoldReason,
          Recipients,
          SenderIp,
          Direction,
          SenderHeader,
          TlsVersion,
          TlsCipher,
          SpamInfo,
          SpamProcessingDetail
  };
  MimecastCG_view
