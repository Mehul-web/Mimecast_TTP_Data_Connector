{
    "streams": [
        "[concat('Custom-', parameters('WASVulnTableName'))]"
    ],
    "destinations": [
        "[concat('RuleDest', variables('suffix'))]"
    ],
    "transformKql": "source| extend TimeGenerated = todatetime(now()), json_plugin = parse_json(plugin), json_asset = parse_json(asset), json_scan = parse_json(scan)| extend json_plugin_vpr = parse_json(json_plugin.vpr), json_plugin_cvss2_vector = parse_json(json_plugin.cvss2_vector), json_plugin_cvss3_vector = parse_json(json_plugin.cvss3_vector)| extend json_plugin_vpr_drivers = parse_json(json_plugin_vpr.drivers)| extend json_plugin_vpr_drivers_age_of_vuln = parse_json(json_plugin_vpr_drivers.age_of_vuln)| extend  plugin_bid = todynamic(json_plugin.bid), plugin_id = toreal(json_plugin.id), plugin_risk_factor = tostring(json_plugin.risk_factor), plugin_original_risk_factor_num = toreal(json_plugin.original_risk_factor_num), plugin_locale = tostring(json_plugin.locale), plugin_type = tostring(json_plugin.type), plugin_intel_type = tostring(json_plugin.intel_type), plugin_name = tostring(json_plugin.name), plugin_publication_date = todatetime(json_plugin.publication_date), plugin_modification_date = todatetime(json_plugin.modification_date), plugin_see_also = todynamic(json_plugin.see_also), plugin_solution = tostring(json_plugin.solution), plugin_synopsis = tostring(json_plugin.synopsis), plugin_description = tostring(json_plugin.description), plugin_patch_publication_date = todatetime(json_plugin.patch_publication_date), plugin_exploitability_ease = tostring(json_plugin.exploitability_ease), plugin_public_display = toreal(json_plugin.public_display), plugin_policy = todynamic(json_plugin.policy), plugin_xrefs = todynamic(json_plugin.xrefs), plugin_cpe = todynamic(json_plugin.cpe), plugin_cve = todynamic(json_plugin.cve), plugin_cwe = todynamic(json_plugin.cwe), plugin_wasc = todynamic(json_plugin.wasc), plugin_in_the_news = tobool(json_plugin.in_the_news), plugin_exploited_by_malware = tobool(json_plugin.exploited_by_malware), plugin_exploit_frameworks = todynamic(json_plugin.exploit_frameworks), plugin_vpr_score = toreal(json_plugin_vpr.score), plugin_vpr_drivers_age_of_vuln_lower_bound = toreal(json_plugin_vpr_drivers_age_of_vuln.lower_bound), plugin_vpr_drivers_exploit_code_maturity = tostring(json_plugin_vpr_drivers.exploit_code_maturity), plugin_vpr_drivers_cvss_impact_score_predicted = tobool(json_plugin_vpr_drivers.cvss_impact_score_predicted), plugin_vpr_drivers_cvss3_impact_score = toreal(json_plugin_vpr_drivers.cvss3_impact_score), plugin_vpr_drivers_threat_intensity_last28 = tostring(json_plugin_vpr_drivers.threat_intensity_last28), plugin_vpr_drivers_threat_sources_last28 = todynamic(json_plugin_vpr_drivers.threat_sources_last28), plugin_vpr_drivers_product_coverage = tostring(json_plugin_vpr_drivers.product_coverage), plugin_vpr_updated = todatetime(json_plugin_vpr.updated), plugin_cvss2_base_score = toreal(json_plugin.cvss2_base_score), plugin_cvss2_temporal_vector = tostring(json_plugin.cvss2_temporal_vector), plugin_cvss2_vector_access_complexity = tostring(json_plugin_cvss2_vector.access_complexity), plugin_cvss2_vector_access_vector = tostring(json_plugin_cvss2_vector.access_vector), plugin_cvss2_vector_authentication = tostring(json_plugin_cvss2_vector.authentication), plugin_cvss2_vector_availability_impact = tostring(json_plugin_cvss2_vector.availability_impact), plugin_cvss2_vector_confidentiality_impact = tostring(json_plugin_cvss2_vector.confidentiality_impact), plugin_cvss2_vector_integrity_impact = tostring(json_plugin_cvss2_vector.integrity_impact), plugin_cvss2_vector_raw = tostring(json_plugin_cvss2_vector.raw), plugin_cvss3_base_score = toreal(json_plugin.cvss3_base_score), plugin_cvss3_temporal_vector = tostring(json_plugin.cvss3_temporal_vector), plugin_cvss3_vector_access_complexity = tostring(json_plugin_cvss3_vector.access_complexity), plugin_cvss3_vector_access_vector = tostring(json_plugin_cvss3_vector.access_vector), plugin_cvss3_vector_avss3_vector.access_complexity), plugin_cvss3_vector_access_vector = tostring(json_plugin_cvss3_vector.access_vector), plugin_cvss3_vector_availability_impact = tostring(json_plugin_cvss3_vector.availability_impact), plugin_cvss3_vector_confidentiality_impact = tostring(json_plvss3_vector.access_complexity), plugin_cvss3_vector_access_vector = tostring(json_plugin_cvss3_vector.access_vector), plugin_cvss3_vector_avss3_vector.access_complexity), plugin_cvss3_vector_access_vector = tostring(json_plugin_cvss3_vector.access_vector), plugin_cvss3_vector_availability_impact = tostring(json_plugin_cvss3_vector.availability_impact), plugin_cvss3_vector_confidentiality_impact = tostring(json_plugin_cvss3_vector.confidentiality_impact), plugin_cvss3_vector_integrity_impact = tostring(json_plugin_cvss3_vector.integrity_impact), plugin_cvss3_vector_raw = tostring(json_plugin_cvss3_vector.raw), plugin_owasp_2010 = todynamic(json_plugin.owasp_2010), plugin_owasp_2013 = todynamic(json_plugin.owasp_2013), plugin_owasp_2017 = todynamic(json_plugin.owasp_2017), plugin_owasp_2021 = todynamic(json_plugin.owasp_2021), plugin_owasp_api_2019 = todynamic(json_plugin.owasp_api_2019), asset_uuid = tostring(json_asset.uuid), asset_fqdn = tostring(json_asset.fqdn), asset_ipv4s = todynamic(json_asset.ipv4s), asset_ipv4 = tostring(json_asset.ipv4), scan_completed_at = todatetime(json_scan.completed_at), scan_uuid = tostring(json_scan.uuid)| project-away json_plugin, plugin, json_asset, asset, json_scan, scan, json_plugin_vpr, json_plugin_cvss2_vector, json_plugin_cvss3_vector, json_plugin_vpr_drivers, json_plugin_vpr_drivers_age_of_vuln",
    "outputStream": "[concat('Custom-', parameters('WASVulnTableName'), '_CL')]"
}



source| extend TimeGenerated = todatetime(now()), json_plugin = parse_json(plugin), json_asset = parse_json(asset), json_scan = parse_json(scan)
| extend json_plugin_vpr = parse_json(json_plugin.vpr), json_plugin_cvss2_vector = parse_json(json_plugin.cvss2_vector), json_plugin_cvss3_vector = parse_json(json_plugin.cvss3_vector)
| extend json_plugin_vpr_drivers = parse_json(json_plugin_vpr.drivers)
| extend json_plugin_vpr_drivers_age_of_vuln = parse_json(json_plugin_vpr_drivers.age_of_vuln)
| extend  plugin_bid = todynamic(json_plugin.bid), plugin_id = toreal(json_plugin.id), plugin_risk_factor = tostring(json_plugin.risk_factor), plugin_original_risk_factor_num = toreal(json_plugin.original_risk_factor_num), plugin_locale = tostring(json_plugin.locale), plugin_type = tostring(json_plugin.type), plugin_intel_type = tostring(json_plugin.intel_type), plugin_name = tostring(json_plugin.name), plugin_publication_date = todatetime(json_plugin.publication_date), plugin_modification_date = todatetime(json_plugin.modification_date), plugin_see_also = todynamic(json_plugin.see_also), plugin_solution = tostring(json_plugin.solution), plugin_synopsis = tostring(json_plugin.synopsis), plugin_description = tostring(json_plugin.description), plugin_patch_publication_date = todatetime(json_plugin.patch_publication_date), plugin_exploitability_ease = tostring(json_plugin.exploitability_ease), plugin_public_display = toreal(json_plugin.public_display), plugin_policy = todynamic(json_plugin.policy), plugin_xrefs = todynamic(json_plugin.xrefs), plugin_cpe = todynamic(json_plugin.cpe), plugin_cve = todynamic(json_plugin.cve), plugin_cwe = todynamic(json_plugin.cwe), plugin_wasc = todynamic(json_plugin.wasc), plugin_in_the_news = tobool(json_plugin.in_the_news), plugin_exploited_by_malware = tobool(json_plugin.exploited_by_malware), plugin_exploit_frameworks = todynamic(json_plugin.exploit_frameworks), plugin_vpr_score = toreal(json_plugin_vpr.score), plugin_vpr_drivers_age_of_vuln_lower_bound = toreal(json_plugin_vpr_drivers_age_of_vuln.lower_bound), plugin_vpr_drivers_exploit_code_maturity = tostring(json_plugin_vpr_drivers.exploit_code_maturity), plugin_vpr_drivers_cvss_impact_score_predicted = tobool(json_plugin_vpr_drivers.cvss_impact_score_predicted), plugin_vpr_drivers_cvss3_impact_score = toreal(json_plugin_vpr_drivers.cvss3_impact_score), plugin_vpr_drivers_threat_intensity_last28 = tostring(json_plugin_vpr_drivers.threat_intensity_last28), plugin_vpr_drivers_threat_sources_last28 = todynamic(json_plugin_vpr_drivers.threat_sources_last28), plugin_vpr_drivers_product_coverage = tostring(json_plugin_vpr_drivers.product_coverage), plugin_vpr_updated = todatetime(json_plugin_vpr.updated), plugin_cvss2_base_score = toreal(json_plugin.cvss2_base_score), plugin_cvss2_temporal_vector = tostring(json_plugin.cvss2_temporal_vector), plugin_cvss2_vector_access_complexity = tostring(json_plugin_cvss2_vector.access_complexity), plugin_cvss2_vector_access_vector = tostring(json_plugin_cvss2_vector.access_vector), plugin_cvss2_vector_authentication = tostring(json_plugin_cvss2_vector.authentication), plugin_cvss2_vector_availability_impact = tostring(json_plugin_cvss2_vector.availability_impact), plugin_cvss2_vector_confidentiality_impact = tostring(json_plugin_cvss2_vector.confidentiality_impact), plugin_cvss2_vector_integrity_impact = tostring(json_plugin_cvss2_vector.integrity_impact), plugin_cvss2_vector_raw = tostring(json_plugin_cvss2_vector.raw), plugin_cvss3_base_score = toreal(json_plugin.cvss3_base_score), plugin_cvss3_temporal_vector = tostring(json_plugin.cvss3_temporal_vector), plugin_cvss3_vector_access_complexity = tostring(json_plugin_cvss3_vector.access_complexity), plugin_cvss3_vector_access_vector = tostring(json_plugin_cvss3_vector.access_vector), plugin_cvss3_vector_availability_impact = tostring(json_plugin_cvss3_vector.availability_impact), plugin_cvss3_vector_confidentiality_impact = tostring(json_plugin_cvss3_vector.confidentiality_impact), plugin_cvss3_vector_integrity_impact = tostring(json_plugin_cvss3_vector.integrity_impact), plugin_cvss3_vector_raw = tostring(json_plugin_cvss3_vector.raw), plugin_owasp_2010 = todynamic(json_plugin.owasp_2010), plugin_owasp_2013 = todynamic(json_plugin.owasp_2013), plugin_owasp_2017 = todynamic(json_plugin.owasp_2017), plugin_owasp_2021 = todynamic(json_plugin.owasp_2021), plugin_owasp_api_2019 = todynamic(json_plugin.owasp_api_2019), asset_uuid = tostring(json_asset.uuid), asset_fqdn = tostring(json_asset.fqdn), asset_ipv4s = todynamic(json_asset.ipv4s), asset_ipv4 = tostring(json_asset.ipv4), scan_completed_at = todatetime(json_scan.completed_at), scan_uuid = tostring(json_scan.uuid)